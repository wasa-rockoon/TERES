(function(){"use strict";var e={1833:function(e,t,a){var i={};a.r(i),a.d(i,{apiEndpoint:function(){return b},apiEndpointDev:function(){return W},charts:function(){return j},mapPaths:function(){return D},packetFormats:function(){return x},packetList:function(){return F},systemId:function(){return T},wsEndpoint:function(){return _},wsEndpointDev:function(){return V}});var l=a(9242),n=a(3396),s=a(7718);function o(e,t){const a=(0,n.up)("router-view");return(0,n.wg)(),(0,n.j4)(s.q,null,{default:(0,n.w5)((()=>[(0,n.Wm)(a)])),_:1})}var r=a(89);const u={},d=(0,r.Z)(u,[["render",o]]);var m=d,c=(a(9773),a(8957));const h={dark:!0,colors:{primary:"#2196F3",background:"#121212",surface:"#303030","primary-darken-1":"#00FF00",secondary:"#0000FF","secondary-darken-1":"#FF0000",info:"#29b6f6",success:"#66bb6a",error:"#f44336",warning:"#ffa726"}};var f=(0,c.Rd)({theme:{defaultTheme:"customTheme",themes:{customTheme:h}}});async function p(){const e=await a.e(461).then(a.t.bind(a,3657,23));e.load({google:{families:["Roboto:100,300,400,500,700,900&display=swap"]}})}var w=a(2483),g=(a(7658),a(7139)),v=a(4870),y=a(7327),k=(a(3767),a(8585),a(8696),a(6265)),U=a.n(k);const T="teres1",b="https://telemeter.fujiy.dev/api",_="ws://telemeter.fujiy.dev/api",W="http://localhost:8888/api",V="ws://localhost:8888/api";function S(e){const t=Math.trunc(e/1e7),a=Math.abs(e)%1e7;return`${t}.${a}`}const x={A:{name:"Attitude",entries:{Q:{name:"Quaternion",datatype:"float32",index:["x","y","z","w"]},A:{name:"Accel",unit:"m/s²",datatype:"float32",index:["x","y","z"]},g:{name:"Gyro",unit:"deg/s",datatype:"float32",index:["x","y","z"]},m:{name:"Mag",unit:"mT",datatype:"float32",index:["x","y","z"]}},timeout:.1},P:{name:"GPS",entries:{O:{name:"Longitude",unit:"°",datatype:"int32",format:S},A:{name:"Latitude",unit:"°",datatype:"int32",format:S},H:{name:"Altitude",unit:"m",datatype:"float32"},T:{name:"Time",unit:"s",datatype:"uint32"},S:{name:"Satellites",datatype:"int32",warning:e=>e<4&&"4 satellites needed"}},timeout:1},C:{name:"TWELITE",entries:{Q:{name:"LQI",datatype:"uint8"},S:{name:"Sent",datatype:"uint32"},R:{name:"Received",datatype:"uint32"}},timeout:1},H:{name:"Air",entries:{T:{name:"Temperature",unit:"℃",datatype:"float32",warning:e=>e>40?"Too hot":e<10&&"Too cold"},P:{name:"Pressure",unit:"Pa",datatype:"float32"},A:{name:"Presssure Alt",unit:"m",datatype:"float32"},h:{name:"Humidity",unit:"RH%",datatype:"float32"}},timeout:1},l:{name:"Logger",entries:{t:{name:"Time",unit:"s",datatype:"uint32"},w:{name:"Wrote",datatype:"uint32"},d:{name:"Dropped",datatype:"uint32",warning:e=>e>0&&"Some packets dropped"}},timeout:1}},F=[{from:"R",name:"Rocket",ids:["A","P","H","C","l"]}],j=[{title:"Altitude",y:[["R","H","A"],["R","P","H"]],yLabel:"Altitude [m]"},{title:"Accelaraion",y:[["R","A","A",0],["R","A","A",1],["R","A","A",2]],yLabel:"Accelaration [m/s²]"}],D=[{from:"R",name:"Rocket",id:"P",lat:"A",lon:"O",color:"#4FC3F7",markerColor:"white"}];class A{constructor(){(0,y.Z)(this,"raw",void 0),(0,y.Z)(this,"view",void 0),(0,y.Z)(this,"size",void 0),this.raw=new ArrayBuffer(4),this.view=new DataView(this.raw),this.size=0}get int8(){return this.view.getInt8(0)}get int16(){return this.view.getInt16(0,!0)}get int32(){return this.view.getInt32(0,!0)}get uint8(){return this.view.getUint8(0)}get uint16(){return this.view.getUint16(0,!0)}get uint32(){return this.view.getUint32(0,!0)}get float16(){const e=this.view.getUint16(0,!0);let t;const a=e>>15,i=e>>10&31,l=1023&e;t=0==i?0==l?a<<31:a<<31|l<<13:31==i?0==l?a<<31|2139095040:a<<31|255<<23|l<<13:a<<31|i-15+127<<23|l<<13;const n=new ArrayBuffer(4),s=new DataView(n);return s.setUint32(0,t,!0),s.getFloat32(0,!0)}get float32(){return this.view.getFloat32(0,!0)}set int8(e){this.view.setUint32(0,0,!0),this.view.setInt8(0,e)}set int16(e){this.view.setUint32(0,0,!0),this.view.setInt16(0,e,!0)}set int32(e){this.view.setInt32(0,e,!0)}set uint8(e){this.view.setUint32(0,0,!0),this.view.setUint8(0,e)}set uint16(e){this.view.setUint32(0,0,!0),this.view.setUint16(0,e,!0)}set uint32(e){this.view.setUint32(0,e,!0)}set float16(e){const t=new ArrayBuffer(4),a=new DataView(t);a.setFloat32(0,e,!0);const i=a.getUint32(0,!0);let l;const n=i>>31,s=i>>23&255,o=8388607&i;l=0==s?0==o?n<<15:n<<15|o>>13:255==s?0==o?n<<15|1984:n<<15|31<<20|o>>13:n<<15|Math.max(Math.min(s-127+15,0),31)<<23|o<<13,a.setUint16(0,l,!0)}set float32(e){this.view.setFloat32(0,e,!0)}}class C{constructor(){(0,y.Z)(this,"type",void 0),(0,y.Z)(this,"payload",void 0),this.type="@",this.payload=new A}encode(e){let t;const a=this.payload.view.getUint32(0,!0);let i=this.type.charCodeAt(0)-64&63;return 4294901760&a?(t=4,i|=192,e.setUint32(1,a,!0)):65280&a?(t=2,i|=128,e.setUint16(1,a,!0)):255&a?(t=1,i|=64,e.setUint8(1,a)):t=0,e.setUint8(0,i),t+1}decode(e,t=3){let a;if(t<3)this.type=String.fromCharCode(127&e.getUint8(0)),a=128&e.getUint8(0)?0:4;else switch(this.type=String.fromCharCode(64+(63&e.getUint8(0))),192&e.getUint8(0)){case 64:a=1;break;case 128:a=2;break;case 192:a=4;break;default:a=0}switch(a){case 1:this.payload.view.setUint8(0,e.getUint8(1));break;case 2:this.payload.view.setUint16(0,e.getUint16(1,!0),!0);break;case 4:this.payload.view.setUint32(0,e.getUint32(1,!0),!0);break}return this.payload.size=a,1+a}formatNumber(e){const t=this.payload[e.datatype];return e.formatNumber?e.formatNumber(t):e.format?Number(e.format(t)):t}format(e){const t=this.payload[e.datatype];return e.format?e.format(t):"float16"==e.datatype?t.toPrecision(3):"float32"==e.datatype?t.toPrecision(7):String(t)}}class O{constructor(e,t,a){(0,y.Z)(this,"id",void 0),(0,y.Z)(this,"from",void 0),(0,y.Z)(this,"size",void 0),(0,y.Z)(this,"entries",void 0),this.id=e,this.from=t,this.size=a,this.entries=[]}get(e,t=0){let a=0,i="";for(const l of this.entries){if(l.type==i?a++:a=0,l.type==e&&a==t)return l;i=l.type}}getTime(){return"t"==this.entries.at(-1)?.type?this.entries.at(-1)?.payload.uint32:void 0}encode(e){e.setUint8(0,this.id?this.id.charCodeAt(0):0),e.setUint8(1,this.from?this.from.charCodeAt(0):0),e.setUint8(2,this.size);let t=3;for(const a of this.entries){const i=new ArrayBuffer(5),l=new DataView(i),n=a.encode(l);e.setUint8(t,l.getUint8(0)),e.setUint32(t+1,l.getUint32(1,!0),!0),t+=n}return t}static decode(e,t=3){const a=e.getUint8(0)?String.fromCharCode(e.getUint8(0)):void 0,i=e.getUint8(1)?String.fromCharCode(e.getUint8(1)):void 0,l=e.getUint8(2),n=new O(a,i,l);let s=3;for(let o=0;o<l;o++){const a=new ArrayBuffer(5),i=new DataView(a);i.setUint8(0,e.getUint8(s)),i.setUint32(1,e.getUint32(s+1,!0),!0);const l=new C;s+=l.decode(i,t),n.entries.push(l)}return n}static async decodeLogFile(e,t=3){const a=await P(e);return t<2?[]:Z(a,(e=>O.decode(new DataView(e),t)))}}function P(e){return new Promise(((t,a)=>{const i=new FileReader;i.onload=()=>{t(i.result)},i.onerror=a,i.readAsArrayBuffer(e)}))}function Z(e,t){const a=[],i=e.byteLength,l=new Uint8Array(e),n=new ArrayBuffer(256),s=new Uint8Array(n,0,256);let o=255,r=0,u=0,d=0;for(;r<i;r++,u--)if(0==u){const e=255!=o;o=l[r],u=o,0==o?(d>3&&a.push(t(n)),d=0,o=255,u=1):e&&(s[d++]=0)}else s[d++]=l[r];return a}const z=b,L=_;U().defaults.baseURL=z,U().defaults.headers.put["Content-Type"]="application/json;charset=utf-8",U().defaults.headers.put["Access-Control-Allow-Origin"]="*";class H{async getSystems(){const e=await U().get("/systems/");return e.data.systems}async getSystem(e){const t=await U().get(`/systems/${e}`,{params:{password:localStorage.password}});return t.data}async putSystem(e){const t=await U().put(`/systems/${e.id}`,null,{params:e});return t.data}async getFlights(e){const t=await U().get(`/systems/${e}/flights/`,{params:{password:localStorage.password}});return t.data.flights.map(this.makeFlight)}async getFlight(e){const t=await U().get(`/flights/${e}`,{params:{password:localStorage.password}});return this.makeFlight(t.data)}async putFlight(e,t,a,i,l,n){const s=await U().put(`/flights/${e}`,null,{params:{password:localStorage.password,name:t,startTime:a,launchTime:i,endTime:l,data:JSON.stringify(n??{})}});return this.makeFlight(s.data)}async postFlight(e,t,a,i){const l=await U().post(`/systems/${e}/flights/`,null,{params:{password:localStorage.password,name:t,startTime:a,endTime:i}});return this.makeFlight(l.data)}async connect(e,t,a,i,l){return new I(e,t,a,i,l).open()}makeFlight(e){const t=Object.assign({},e);return t.startTime=new Date(e.startTime),t.launchTime=new Date(e.launchTime),e.endTime&&(t.endTime=new Date(e.endTime)),t.data={},e.data&&(t.data=JSON.parse(e.data)),t}}const M=20;class I{constructor(e,t,a,i,l){(0,y.Z)(this,"socket",void 0),(0,y.Z)(this,"flightId",void 0),(0,y.Z)(this,"source",void 0),(0,y.Z)(this,"startTime",void 0),(0,y.Z)(this,"endTime",void 0),(0,y.Z)(this,"callback",void 0),(0,y.Z)(this,"timer",void 0),(0,y.Z)(this,"receivedPackets",void 0),this.flightId=e,this.source=t,this.startTime=a,this.endTime=i,this.callback=l??(()=>{}),this.receivedPackets=[]}async open(){return new Promise(((e,t)=>{const a=new URLSearchParams({source:this.source,password:localStorage.password});this.startTime&&a.append("startTime",this.startTime.toISOString()),this.endTime&&a.append("endTime",this.endTime.toISOString()),this.socket=new WebSocket(`${L}/flights/${this.flightId}/packets?${a.toString()}`),this.socket.binaryType="arraybuffer",this.socket.onopen=t=>{e(this)},this.socket.onerror=e=>{console.error(e)},this.socket.onmessage=e=>{this.onMessage(e)},this.socket.onclose=e=>{console.log("closed",e)},this.timer=setInterval((()=>{this.receivedPackets.length>0&&(this.callback(this.receivedPackets),this.receivedPackets=[])}),1e3/M)}))}send(e,t){const a=t.getTime(),i=new ArrayBuffer(256);new DataView(i).setBigInt64(0,BigInt(a),!0);const l=e.encode(new DataView(i,8));this.socket?.send(new DataView(i,0,8+l))}onMessage(e){if(e.data instanceof ArrayBuffer){const t=new ArrayBuffer(256);new Uint8Array(t).set(new Uint8Array(e.data));const a=Number(new DataView(t).getBigInt64(0,!0)),i=new Date(a),l=String.fromCharCode.apply(null,Array.from(new Uint8Array(t,8,8))).split("\0")[0],n=O.decode(new DataView(t,16));this.receivedPackets.push({packet:n,time:i,source:l})}}close(){this.socket?.close(),clearInterval(this.timer)}}const q=new H;var R=a(588),E=a(1556),N=a(6372),B=a(1489),$=a(6572),Y=a(1332),K=a(1888),G=a(1334),J=a(3601),Q=a(6422),X=a(3369),ee=a(6824),te=a(8521),ae=a(9234),ie=a(8694),le=a(3140),ne=a(2902);const se={class:"systemlist"};var oe=(0,n.aZ)({__name:"SystemListView",setup(e){const t=(0,v.iH)([]),a=(0,v.iH)(!1),i=(0,v.iH)(!1),s=(0,v.qj)({id:null,name:null,password:null,client:null});(0,n.bv)((async()=>{t.value=await q.getSystems(),console.log("systems",t.value)}));const o=async()=>{if(!i.value)return;a.value=!1;const e=await q.putSystem(s);t.value.push(e),localStorage.password=s.password,console.log("new system",s,e)},r=e=>!!e||"Field is required";return(e,u)=>((0,n.wg)(),(0,n.iD)("div",se,[(0,n.Wm)(R.L,{color:"primary",height:"40",elevation:"10"},{default:(0,n.w5)((()=>[(0,n.Wm)(E.o,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Systems")])),_:1})])),_:1}),(0,n.Wm)(le.O,null,{default:(0,n.w5)((()=>[(0,n.Wm)(X.K,{fluid:"",class:"d-flex flex-wrap justify-center"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.value,(e=>((0,n.wg)(),(0,n.j4)(B._,{width:"400",key:e.id,href:e.client,elevation:"6",class:"ma-2"},{default:(0,n.w5)((()=>[(0,n.Wm)(ie.f,{src:e.client+"/image",height:"200"},null,8,["src"]),(0,n.Wm)($.E,{class:"text-h5"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(e.name),1)])),_:2},1024),(0,n.Wm)(Y.Q,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(e.id),1)])),_:2},1024),(0,n.Wm)(K.Z)])),_:2},1032,["href"])))),128))])),_:1}),(0,n.Wm)(ee.o,null,{default:(0,n.w5)((()=>[(0,n.Wm)(J.B,{modelValue:a.value,"onUpdate:modelValue":u[6]||(u[6]=e=>a.value=e),width:"auto"},{activator:(0,n.w5)((({props:e})=>[(0,n.Wm)(te.D,null,{default:(0,n.w5)((()=>[(0,n.Wm)(N.T,(0,n.dG)({icon:"mdi-plus",color:"primary"},e),null,16)])),_:2},1024)])),default:(0,n.w5)((()=>[(0,n.Wm)(B._,{class:"px-10",width:"600"},{default:(0,n.w5)((()=>[(0,n.Wm)($.E,{class:"my-5"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Register New System ")])),_:1}),(0,n.Wm)(Q.O,{modelValue:i.value,"onUpdate:modelValue":u[5]||(u[5]=e=>i.value=e),onSubmit:(0,l.iM)(o,["prevent"])},{default:(0,n.w5)((()=>[(0,n.Wm)(ne.hw,{modelValue:s.id,"onUpdate:modelValue":u[0]||(u[0]=e=>s.id=e),label:"ID",rules:[r]},null,8,["modelValue","rules"]),(0,n.Wm)(ne.hw,{modelValue:s.name,"onUpdate:modelValue":u[1]||(u[1]=e=>s.name=e),label:"Name",rules:[r]},null,8,["modelValue","rules"]),(0,n.Wm)(ne.hw,{modelValue:s.password,"onUpdate:modelValue":u[2]||(u[2]=e=>s.password=e),label:"Password",type:"password",rules:[r]},null,8,["modelValue","rules"]),(0,n.Wm)(ne.hw,{modelValue:s.client,"onUpdate:modelValue":u[3]||(u[3]=e=>s.client=e),label:"Client URL"},null,8,["modelValue"]),(0,n.Wm)(G.h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(ae.C),(0,n.Wm)(N.T,{color:"primary",onClick:u[4]||(u[4]=e=>a.value=!1)},{default:(0,n.w5)((()=>[(0,n.Uk)("Cancel")])),_:1}),(0,n.Wm)(N.T,{color:"primary",disabled:!i.value,type:"submit"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Register ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})]))}});const re=oe;var ue=re,de=a(6725),me=(0,n.aZ)({__name:"LoginModal",props:["system"],emits:["login"],setup(e,{emit:t}){const a=e,i=(0,v.iH)(!1),s=(0,v.iH)(!1),o=(0,v.iH)(""),r=async()=>{if(!s.value)return;localStorage.password=o.value,i.value=!1;const e=await q.getSystem(a.system.id);t("login",e)},u=e=>!!e||"Password is required";return(e,t)=>((0,n.wg)(),(0,n.j4)(J.B,{modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=e=>i.value=e),width:"auto"},{activator:(0,n.w5)((({props:e})=>[a.system?.admin?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(N.T,(0,n.dG)({key:0,icon:"mdi-lock"},e),null,16)),a.system?.admin?((0,n.wg)(),(0,n.j4)(N.T,(0,n.dG)({key:1,icon:"mdi-check"},e),null,16)):(0,n.kq)("",!0)])),default:(0,n.w5)((()=>[(0,n.Wm)(B._,{class:"px-10",width:"600"},{default:(0,n.w5)((()=>[(0,n.Wm)($.E,{class:"my-5"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Login with Password ")])),_:1}),(0,n.Wm)(Q.O,{modelValue:s.value,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value=e),onSubmit:(0,l.iM)(r,["prevent"])},{default:(0,n.w5)((()=>[(0,n.Wm)(ne.hw,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),label:"Password",type:"password",rules:[u]},null,8,["modelValue","rules"]),(0,n.Wm)(G.h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(ae.C),(0,n.Wm)(N.T,{color:"primary",disabled:!s.value,type:"submit"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Login ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"]))}});const ce=me;var he=ce,fe=a(4075),pe=a(3121),we=a(3289),ge=a(8275),ve=a(7754),ye=a(3150),ke=a(2127),Ue=a(7769),Te=a(9922);const be={class:"system"},_e={class:"my-5"};var We=(0,n.aZ)({__name:"SystemView",setup(e){const t=(0,v.iH)(void 0),a=(0,v.qj)([]),i=((0,v.qj)({dialog:!1,form:!1,password:null}),(0,v.qj)({dialog:!1,form:!1,name:"New Flight"})),s=(0,v.qj)({dialog:!1,form:!1,name:null,source:"log",startTime:new Date,file:null,version:"v3",origin:""}),o=(0,w.tv)();(0,n.bv)((async()=>{const e=(0,n.f3)("systemId");try{t.value=await q.getSystem(e),console.log("system",t.value);const i=await q.getFlights(e);console.log("flights",i);for(const e of i)t.value?.activeFlight&&e.id==t.value?.activeFlight.id||a.push(e)}catch(i){console.log("unknown system",e,i),o.push("/systems")}}));const r=e=>{t.value=e},u=async()=>{if(!i.name)return;console.log(i.name),i.dialog=!1;const e=await q.postFlight(t.value.id,i.name,!0);console.log("new flight",e),t.value?.activeFlight&&a.push(t.value?.activeFlight),t.value&&(t.value.activeFlight=e)},d=async()=>{if(console.log("file",s.file),!s.file)return;s.dialog=!1;const e={v1:1,v2:2,v3:3}[s.version],i=await O.decodeLogFile(s.file[0],e);for(const t of i)t.from=t.from??s.origin;if(0==i.length)return;const l=await q.postFlight(t.value.id,s.name,s.startTime,new Date(s.startTime.getTime()+i.at(-1)?.getTime()));console.log("new flight",l),a.push(l);const n=await q.connect(l.id,s.source);for(const t of i)n.send(t,new Date(s.startTime.getTime()+t.getTime()));n.close()},m=e=>!!e||"Field is required",c=e=>e.length<=8||"Length of source name must be smaller than 8",h=e=>e.length<=1||"Origin id must be a charactor",f=e=>{if(!e)return"";const t=new Date(e);return t.toLocaleString()};return(e,o)=>((0,n.wg)(),(0,n.iD)("div",be,[(0,n.Wm)(R.L,{color:"primary",height:"40"},{default:(0,n.w5)((()=>[(0,n.Wm)(N.T,{icon:"mdi-arrow-left",to:"/systems"}),(0,n.Wm)(E.o,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(t.value?.name),1)])),_:1}),(0,n.Wm)((0,v.SU)(he),{system:t.value,onLogin:r},null,8,["system"])])),_:1}),(0,n.Wm)(le.O,null,{default:(0,n.w5)((()=>[(0,n.Wm)(B._,{class:"ma-10"},{default:(0,n.w5)((()=>[(0,n.Wm)(ge.i,null,{default:(0,n.w5)((()=>[(0,n.Wm)(ee.o,{class:"d-flex justify-space-between ma-0"},{default:(0,n.w5)((()=>[(0,n.Wm)(ve.b,null,{default:(0,n.w5)((()=>[(0,n.Uk)(" Active Flight ")])),_:1}),t.value?.admin?((0,n.wg)(),(0,n.j4)(J.B,{key:0,modelValue:i.dialog,"onUpdate:modelValue":o[3]||(o[3]=e=>i.dialog=e),width:"auto"},{activator:(0,n.w5)((({props:e})=>[(0,n.Wm)(N.T,(0,n.dG)(e,{variant:"outlined",color:"primary",class:"ma-2","prepend-icon":"mdi-rocket-launch"}),{default:(0,n.w5)((()=>[(0,n.Uk)(" New Flight ")])),_:2},1040)])),default:(0,n.w5)((()=>[(0,n.Wm)(B._,{class:"px-10",width:"600"},{default:(0,n.w5)((()=>[(0,n.Wm)($.E,{class:"my-5"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Start New Flight ")])),_:1}),(0,n.Wm)(Q.O,{modelValue:i.form,"onUpdate:modelValue":o[2]||(o[2]=e=>i.form=e),onSubmit:(0,l.iM)(u,["prevent"])},{default:(0,n.w5)((()=>[(0,n.Wm)(ne.hw,{modelValue:i.name,"onUpdate:modelValue":o[0]||(o[0]=e=>i.name=e),label:"Name",rules:[m]},null,8,["modelValue","rules"]),(0,n.Wm)(G.h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(ae.C),(0,n.Wm)(N.T,{color:"primary",onClick:o[1]||(o[1]=e=>i.dialog=!1)},{default:(0,n.w5)((()=>[(0,n.Uk)(" Cancel")])),_:1}),(0,n.Wm)(N.T,{color:"primary",disabled:!i.name,type:"submit"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Start ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"])):(0,n.kq)("",!0)])),_:1}),t.value?.activeFlight?((0,n.wg)(),(0,n.j4)(ye.l,{key:0,to:"/flight?id="+t.value.activeFlight.id},{prepend:(0,n.w5)((()=>[(0,n.Wm)(we.t,{icon:"mdi-rocket-launch",color:"primary"})])),default:(0,n.w5)((()=>[(0,n.Wm)(ke.V,{textContent:(0,g.zw)(t.value?.activeFlight.name)},null,8,["textContent"]),(0,n.Wm)(Ue.o,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(f(t.value?.activeFlight.startTime))+" ~ "+(0,g.zw)(f(t.value?.activeFlight.endTime)),1)])),_:1})])),_:1},8,["to"])):(0,n.kq)("",!0),(0,n.Wm)(fe.J,{inset:""}),(0,n.Wm)(ee.o,{class:"d-flex justify-space-between ma-0"},{default:(0,n.w5)((()=>[(0,n.Wm)(ve.b,null,{default:(0,n.w5)((()=>[(0,n.Uk)(" Past Flights ")])),_:1}),t.value?.admin?((0,n.wg)(),(0,n.j4)(J.B,{key:0,modelValue:s.dialog,"onUpdate:modelValue":o[12]||(o[12]=e=>s.dialog=e),width:"auto"},{activator:(0,n.w5)((({props:e})=>[(0,n.Wm)(N.T,(0,n.dG)(e,{variant:"outlined",color:"primary",class:"ma-2","prepend-icon":"mdi-cloud-upload"}),{default:(0,n.w5)((()=>[(0,n.Uk)(" Upload Log File ")])),_:2},1040)])),default:(0,n.w5)((()=>[(0,n.Wm)(B._,{class:"px-10",width:"600","min-height":"700"},{default:(0,n.w5)((()=>[(0,n.Wm)($.E,{class:"my-5"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Upload Log File ")])),_:1}),(0,n.Wm)(Q.O,{modelValue:s.form,"onUpdate:modelValue":o[11]||(o[11]=e=>s.form=e),onSubmit:(0,l.iM)(d,["prevent"])},{default:(0,n.w5)((()=>[(0,n.Wm)(ne.hw,{modelValue:s.name,"onUpdate:modelValue":o[4]||(o[4]=e=>s.name=e),label:"Name",rules:[m]},null,8,["modelValue","rules"]),(0,n._)("div",_e,[(0,n.Uk)(" Start Date "),(0,n.Wm)((0,v.SU)(de.Z),{modelValue:s.startTime,"onUpdate:modelValue":o[5]||(o[5]=e=>s.startTime=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,n.Wm)(pe.Z,{label:"File input",modelValue:s.file,"onUpdate:modelValue":o[6]||(o[6]=e=>s.file=e),"show-size":"","prepend-icon":"mdi-file"},null,8,["modelValue"]),(0,n.Wm)(Te.r,{modelValue:s.version,"onUpdate:modelValue":o[7]||(o[7]=e=>s.version=e),label:"Log file version",items:["v1","v2","v3"]},null,8,["modelValue"]),(0,n.Wm)(ne.hw,{modelValue:s.source,"onUpdate:modelValue":o[8]||(o[8]=e=>s.source=e),label:"Source name",rules:[m,c]},null,8,["modelValue","rules"]),(0,n.Wm)(ne.hw,{modelValue:s.origin,"onUpdate:modelValue":o[9]||(o[9]=e=>s.origin=e),label:"Default origin",rules:[h]},null,8,["modelValue","rules"]),(0,n.Wm)(G.h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(ae.C),(0,n.Wm)(N.T,{color:"primary",onClick:o[10]||(o[10]=e=>s.dialog=!1)},{default:(0,n.w5)((()=>[(0,n.Uk)(" Cancel")])),_:1}),(0,n.Wm)(N.T,{color:"primary",disabled:!s.form,type:"submit"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Upload ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"])):(0,n.kq)("",!0)])),_:1}),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a,(e=>((0,n.wg)(),(0,n.j4)(ye.l,{key:e.name,to:"/flight?id="+e.id},{prepend:(0,n.w5)((()=>[(0,n.Wm)(we.t,{icon:"mdi-rocket"})])),default:(0,n.w5)((()=>[(0,n.Wm)(ke.V,{textContent:(0,g.zw)(e.name)},null,8,["textContent"]),(0,n.Wm)(Ue.o,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(f(e.startTime))+" ~ "+(0,g.zw)(f(e.endTime)),1)])),_:2},1024)])),_:2},1032,["to"])))),128))])),_:1})])),_:1})])),_:1})]))}});const Ve=We;var Se=Ve;class xe{get startTime(){return this.flight.startTime}get launchTime(){return this.flight.launchTime}get endTime(){return this.flight.endTime}get startT(){return this.time2t(this.startTime)}get launchT(){return this.time2t(this.launchTime)}get endT(){return this.endTime&&this.time2t(this.endTime)}get nowT(){return this.time2t(new Date)}get earliestT(){const e=Math.min.apply(null,this.mapDataseries((e=>e.earliest?.t)).filter((e=>e)));return isFinite(e)?e:void 0}get latestT(){const e=Math.max.apply(null,this.mapDataseries((e=>e.latest?.t)).filter((e=>e)));return isFinite(e)?e:void 0}mapDataseries(e){return Object.values(this.dataseries).flatMap((t=>Object.values(t).map(e)))}constructor(e){(0,y.Z)(this,"flight",void 0),(0,y.Z)(this,"dataseries",void 0),this.flight=e,this.dataseries={}}getBy(e,t){return this.dataseries[e]||(this.dataseries[e]={}),this.dataseries[e][t]||(this.dataseries[e][t]=new Fe(this,e,t)),this.dataseries[e][t]}addPackets(e){const t={};for(const a of e)a.packet.from&&a.packet.id&&(t[a.packet.from]||(t[a.packet.from]={}),t[a.packet.from][a.packet.id]||(t[a.packet.from][a.packet.id]=[]),t[a.packet.from][a.packet.id].push(a));for(const[a,i]of Object.entries(t)){this.dataseries[a]||(this.dataseries[a]={});for(const[e,t]of Object.entries(i))this.dataseries[a][e]||(this.dataseries[a][e]=new Fe(this,a,e)),this.dataseries[a][e].addPackets(t.map((e=>(e.unixTime=e.time.getTime(),e))))}}showT(e){const t=Math.abs(e);let a="T";a+=e>=0?"+":"-";const i=Math.round(1e3*t)%1e3,l=Math.floor(t)%60,n=Math.floor(t/60)%60,s=Math.floor(t/60/60)%24,o=Math.floor(t/60/60/24);return o>0&&(a+=o.toString()+" "),s>0&&(a+=s.toString().padStart(2,"0")+":"),a+=n.toString().padStart(2,"0")+":",a+=l.toString().padStart(2,"0")+".",a+=i.toString().padStart(3,"0"),a}time2t(e){return Math.floor(e.getTime()-this.flight.launchTime.getTime())/1e3}t2time(e){return new Date(1e3*(this.flight.launchTime.getTime()/1e3+e))}}class Fe{get sources(){return Object.keys(this.sourceAvailables)}get earliest(){let e;return this.data.length>0&&(e=this.data.at(0)),{id:this.id,packet:e&&e.packet,t:e&&this.datastore.time2t(new Date(e.unixTime)),source:e&&e.source,format:this.format,count:e?1:0}}get latest(){let e;return this.data.length>0&&(e=this.data.at(-1)),{id:this.id,packet:e&&e.packet,t:e&&this.datastore.time2t(new Date(e.unixTime)),source:e&&e.source,format:this.format,count:this.data.length}}constructor(e,t,a){(0,y.Z)(this,"datastore",void 0),(0,y.Z)(this,"from",void 0),(0,y.Z)(this,"id",void 0),(0,y.Z)(this,"format",void 0),(0,y.Z)(this,"data",void 0),(0,y.Z)(this,"times",void 0),(0,y.Z)(this,"values",void 0),(0,y.Z)(this,"sourceAvailables",void 0),(0,y.Z)(this,"cursor",void 0),this.datastore=e,this.from=t,this.id=a,this.format=x[a],this.data=[],this.sourceAvailables={},this.cursor=0,this.times=[],this.values={};for(const i of Object.keys(this.format?.entries??{}))this.values[i]=new Array(this.format.entries[i]?.index?.length??1).fill(0).map((()=>[]))}at(e){const t=this.searchIndex(e.getTime());let a;return t>=0&&(a=this.data[t]),{id:this.id,packet:a&&a.packet,t:a&&this.datastore.time2t(new Date(a.unixTime)),source:a&&a.source,format:this.format,count:a?t+1:0}}getTimes(e,t,a){const i=this.cursor;let l=e&&this.searchIndex(this.datastore.t2time(e).getTime());(!l||l<0)&&(l=0);let n=t&&this.searchIndex(this.datastore.t2time(t).getTime());(!n||n<0)&&(n=this.times.length-1);this.times.slice(l,n);return this.cursor=i,this.times}getValues(e,t=0,a,i,l){const n=this.cursor;if(!this.values[e]||!this.values[e][t])return[];let s=a&&this.searchIndex(this.datastore.t2time(a).getTime());(!s||s<0)&&(s=0);let o=i&&this.searchIndex(this.datastore.t2time(i).getTime());(!o||o<0)&&(o=this.times.length-1);const r=this.values[e][t].slice(s,o);return this.cursor=n,r}addPackets(e){if(0==e.length)return;this.cursor=this.data.length-1,e.sort(((e,t)=>e.unixTime-t.unixTime));const t={};for(const a of e){let e=0,i="";a.packet.entries.forEach(((l,n)=>{if(n==a.packet.entries.length-1&&"t"==l.type)return;l.type==i?e++:e=0,i=l.type;const s=this.format?.entries[l.type];s&&(t[l.type]||(t[l.type]=new Array(s.index?.length??1).fill(0).map((()=>[]))),t[l.type][e].push(l.formatNumber(s)))}))}for(let a=0;a<e.length;a++){const i=this.searchIndex(e[a].unixTime);if(0==this.data.length||i==this.data.length-1){this.data.push(...e.slice(a)),this.times.push(...e.slice(a).map((e=>this.datastore.time2t(new Date(e.unixTime)))));for(const e of Object.keys(this.format?.entries??{}))t[e].forEach(((t,i)=>{this.values[e][i].push(...t.slice(a))}));break}this.data.splice(i+1,0,e[a]),this.times.splice(i+1,0,this.datastore.time2t(new Date(e[a].unixTime)));for(const e of Object.keys(this.format?.entries??{}))t[e].forEach(((t,l)=>{this.values[e][l].splice(i+1,0,t[a])}));this.cursor=i}this.cursor=this.data.length-1}searchIndex(e){if(0==this.data.length)return 0;let t=.5;if(e<this.data[this.cursor].unixTime){while(e<this.data[this.cursor].unixTime)if(t*=2,this.cursor-=t,this.cursor<0)return this.cursor=0,-1;t/=2}else{while(e>this.data[this.cursor].unixTime)if(t*=2,this.cursor+=t,this.cursor>=this.data.length)return this.cursor=this.data.length-1,this.data.length-1;t/=2}while(t>=1){if(e<this.data[this.cursor].unixTime)this.cursor-=t;else{if(!(e>this.data[this.cursor].unixTime))break;this.cursor+=t}t/=2}return e<this.data[this.cursor].unixTime&&this.cursor--,this.cursor}}const je={class:"my-5"},De={class:"my-5"},Ae={class:"my-5"},Ce={class:"my-5"},Oe={class:"my-5"};var Pe=(0,n.aZ)({__name:"FlightSettings",props:["flight"],emits:["update"],setup(e,{emit:t}){const a=e,i=(0,v.iH)(!1),s=(0,v.iH)(!1),o=(0,v.iH)(""),r=(0,v.iH)(new Date),u=(0,v.iH)(null),d=(0,v.iH)(null),m=(0,v.iH)([{},{}]),c=async()=>{console.log("save",m.value);const e=await q.putFlight(a.flight.id,o.value,r.value,u.value,d.value,{videos:m.value});console.log("save",e),t("update",e)};(0,n.YP)(a,((e,t)=>{o.value=e.flight?.name,r.value=e.flight.startTime,u.value=e.flight.launchTime,d.value=e.flight.endTime,m.value=e.flight.data.videos??[{},{}]}));const h=e=>!!e||"Field is required";return(e,t)=>((0,n.wg)(),(0,n.j4)(J.B,{modelValue:i.value,"onUpdate:modelValue":t[9]||(t[9]=e=>i.value=e),width:"auto",class:"overflow-visible"},{activator:(0,n.w5)((({props:e})=>[(0,n.Wm)(N.T,(0,n.dG)(e,{size:"x-large",class:"text-capitalize"}),{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(a.flight?.system?.name)+" - "+(0,g.zw)(a.flight?.name),1)])),_:2},1040)])),default:(0,n.w5)((()=>[(0,n.Wm)(B._,{class:"px-10",width:"600","min-height":"800"},{default:(0,n.w5)((()=>[(0,n.Wm)($.E,{class:"my-5"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Settings ")])),_:1}),(0,n.Wm)(Q.O,{modelValue:s.value,"onUpdate:modelValue":t[8]||(t[8]=e=>s.value=e),onSubmit:(0,l.iM)(c,["prevent"])},{default:(0,n.w5)((()=>[(0,n.Wm)(ne.hw,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),label:"Name",rules:[h]},null,8,["modelValue","rules"]),(0,n._)("div",je,[(0,n.Uk)(" Start time "),(0,n.Wm)((0,v.SU)(de.Z),{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,n._)("div",De,[(0,n.Uk)(" Launch time "),(0,n.Wm)((0,v.SU)(de.Z),{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,n._)("div",Ae,[(0,n.Uk)(" End time "),(0,n.Wm)((0,v.SU)(de.Z),{modelValue:d.value,"onUpdate:modelValue":t[3]||(t[3]=e=>d.value=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,n._)("div",Ce,[(0,n.Uk)(" Video 1 "),(0,n.Wm)(ne.hw,{modelValue:m.value[0].url,"onUpdate:modelValue":t[4]||(t[4]=e=>m.value[0].url=e),label:"URL"},null,8,["modelValue"]),(0,n.Wm)((0,v.SU)(de.Z),{modelValue:m.value[0].startTime,"onUpdate:modelValue":t[5]||(t[5]=e=>m.value[0].startTime=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,n._)("div",Oe,[(0,n.Uk)(" Video 2 "),(0,n.Wm)(ne.hw,{modelValue:m.value[1].url,"onUpdate:modelValue":t[6]||(t[6]=e=>m.value[1].url=e),label:"URL"},null,8,["modelValue"]),(0,n.Wm)((0,v.SU)(de.Z),{modelValue:m.value[1].startTime,"onUpdate:modelValue":t[7]||(t[7]=e=>m.value[1].startTime=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,n.Wm)(G.h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(ae.C),(0,n.Wm)(N.T,{color:"primary",type:"submit"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Save ")])),_:1})])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"]))}});const Ze=Pe;var ze=Ze,Le=a(8303),He=a.n(Le),Me=a(6119);const Ie={key:0};var qe=(0,n.aZ)({__name:"FlightTimeline",emits:["change-chart-range","change-time"],setup(e,{emit:t}){const a=(0,n.f3)("datastore"),i=(0,v.iH)(!1),l=(0,v.iH)(null),s=(0,v.iH)(null),o=(0,v.iH)([]),r=(0,n.Fl)((()=>o.value[1])),u=(0,n.Fl)((()=>a.value?.startT)),d=(0,n.Fl)((()=>a.value?.endT??a.value?.nowT)),m=[{tooltip:"active"},{tooltip:"none"},{tooltip:"active"}],c=(0,n.Fl)((()=>{const e={};return a.value&&(e[r.value]={label:"",style:{width:"18px",height:"18px",display:"block",backgroundColor:"#2196F3",transform:"translate(-7px, -7px)"}},e[Math.round(a.value.launchT).toString()]={label:"Launch",style:{width:"8px",height:"8px",display:"block",backgroundColor:"#303030",transform:"translate(-2px, -2px)"}}),e})),h=e=>{if(!a.value)return[];const t=a.value.earliestT??a.value.startT,i=a.value.latestT??a.value.endT??a.value.nowT;return[[k(t),k(i),{backgroundColor:"#2196F3"}]]},f=e=>e==Math.min(o.value[0],o.value[2])?`Chart min: ${a.value?.showT(e)}`:e==Math.max(o.value[0],o.value[2])?`Chart max: ${a.value?.showT(e)}`:"";let p=null,w=null;const y=e=>{p&&i.value&&(w=o.value[1]+(e-p)/1e3,w>d.value&&(w=d.value),s.value.setValue([o.value[0],w,o.value[2]])),p=e,requestAnimationFrame(y)};(0,n.bv)((()=>{requestAnimationFrame(y)})),(0,n.YP)(o,((e,i)=>{e[1]!=i[1]&&(e[1],t("change-time",a.value.t2time(r.value))),e[0]==i[0]&&e[2]==i[2]||t("change-chart-range",{min:Math.min(e[0],e[2]),max:Math.max(e[0],e[2])})})),(0,n.YP)(l,((e,t)=>{void 0==e?i.value=!1:0==e?(i.value=!1,l.value=null,s.value.setValue([o.value[0],a.value.startT,o.value[2]])):1==e&&i.value?(i.value=!1,l.value=null):1==e?i.value=!0:2==e&&(s.value.setValue([o.value[0],a.value.endT??a.value.nowT,o.value[2]]),i.value=!0)})),(0,n.YP)(a,((e,t)=>{t||(o.value=[u.value,a.value.endTime?0:d.value,d.value])}));const k=e=>{const t=d.value-u.value,a=(e-u.value)/t*100;return a<0?0:a>100?100:a};return(e,t)=>((0,n.wg)(),(0,n.j4)(X.K,{id:"timeline",class:"w-screen ma-0 pa-0"},{default:(0,n.w5)((()=>[(0,n.Wm)(ee.o,{align:"center"},{default:(0,n.w5)((()=>[(0,n.Wm)(te.D,{id:"timeline-t"},{default:(0,n.w5)((()=>[(0,v.SU)(a)?((0,n.wg)(),(0,n.iD)("span",Ie,(0,g.zw)((0,v.SU)(a).showT((0,v.SU)(r))),1)):(0,n.kq)("",!0)])),_:1}),(0,n.Wm)(te.D,{"align-self":"start"},{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(He()),{id:"timeline-slider",modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),ref_key:"sliderRef",ref:s,min:(0,v.SU)(u),max:(0,v.SU)(d),interval:.001,process:h,marks:(0,v.SU)(c),"dot-options":m,order:!1,"enable-cross":!0,"drag-on-click":!0,"tooltip-placement":"top","tooltip-formatter":f,"dot-size":[10,10],duration:0,contained:!0},null,8,["modelValue","min","max","interval","marks"])])),_:1}),(0,n.Wm)(te.D,{id:"timeline-control"},{default:(0,n.w5)((()=>[(0,n.Wm)(Me.f,{modelValue:l.value,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value=e),divided:"",variant:"outlined",color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(N.T,{icon:"mdi-skip-backward"}),i.value?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(N.T,{key:0,icon:"mdi-play"})),i.value?((0,n.wg)(),(0,n.j4)(N.T,{key:1,icon:"mdi-pause"})):(0,n.kq)("",!0),(0,n.Wm)(N.T,{icon:"mdi-skip-forward"})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}))}});const Re=qe;var Ee=Re,Ne=a(1209),Be=a(917),$e=a(4413),Ye=a(678);const Ke={class:"text-left"},Ge={key:0,class:"text-right text-error"},Je={key:1,class:"text-right text-warning"},Qe={key:2,class:"text-right"};var Xe=(0,n.aZ)({__name:"PacketList",props:["time"],setup(e){const t=e,a=(0,n.f3)("datastore"),i={};F.forEach((e=>{i[e.from]=e.ids}));const l=(0,v.iH)(i),s=(0,n.Fl)((()=>a.value?F.map((e=>{const i=e.ids.map((i=>a.value.getBy(e.from,i)?.at(t.time??new Date))).filter((e=>e));return{data:i,from:e.from,name:e.name}})):[]));(0,n.YP)(s,(()=>{}));const o=(e,t)=>{const a=[];let i=0,l="";return t.entries.forEach(((n,s)=>{if(s==t.entries.length-1&&"t"==n.type)return;n.type==l?i++:i=0,l=n.type;const o=e?.entries[n.type];if(o){let e=o.name;o.index&&(e+=` (${o.index[i]})`),o.unit&&(e+=` [${o.unit}]`);const t=n.format(o);a.push({title:e,value:t,error:o.error&&o.error(t),warning:o.warning&&o.warning(t)})}else a.push({title:n.type,value:n.payload.int32,error:"Unknown entry",warning:null})})),a},r=e=>{if(!e.format.timeout)return 0;const i=a.value.time2t(t.time)-e.t;return i>e.format.timeout?i:0},u=e=>!(!e.format.error||!e.format.error(e.packet))||e.packet.entries.some((t=>{const a=e.format.entries[t.type];return"t"!=t.type&&!a||a&&a.error&&a.error(t.format(a))})),d=e=>!(!e.format.warning||!e.format.warning(e.packet))||e.packet.entries.some((t=>{const a=e.format.entries[t.type];return a&&a.warning&&a.warning(t.format(a))}));return(e,t)=>((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,v.SU)(s),((e,t)=>((0,n.wg)(),(0,n.j4)(B._,{key:t},{default:(0,n.w5)((()=>[(0,n.Wm)(Ne._,null,{prepend:(0,n.w5)((()=>[e.data.some((e=>!e.packet))?((0,n.wg)(),(0,n.j4)(we.t,{key:0,icon:"mdi-help-circle"})):e.data.some(u)?((0,n.wg)(),(0,n.j4)(we.t,{key:1,color:"error",icon:"mdi-alert-circle"})):e.data.some(d)?((0,n.wg)(),(0,n.j4)(we.t,{key:2,color:"warning",icon:"mdi-alert"})):e.data.some(r)?((0,n.wg)(),(0,n.j4)(we.t,{key:3,color:"warning",icon:"mdi-clock-alert-outline"})):((0,n.wg)(),(0,n.j4)(we.t,{key:4,icon:"mdi-check",color:"primary"}))])),append:(0,n.w5)((()=>[(0,n.Wm)(N.T,{density:"compact",icon:"mdi-dots-vertical"})])),default:(0,n.w5)((()=>[(0,n.Wm)($.E,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(e.name),1)])),_:2},1024)])),_:2},1024),(0,n.Wm)(K.Z,{class:"pa-0"},{default:(0,n.w5)((()=>[(0,n.Wm)(ge.i,{opened:l.value[e.from],"onUpdate:opened":t=>l.value[e.from]=t},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.data,(e=>((0,n.wg)(),(0,n.j4)(Be.NU,{key:e.id,value:e.id},{activator:(0,n.w5)((({props:t})=>[(0,n.Wm)(ye.l,(0,g.vs)((0,n.F4)(t)),{prepend:(0,n.w5)((()=>[e.packet?u(e)?((0,n.wg)(),(0,n.j4)(we.t,{key:1,color:"error",icon:"mdi-alert-circle"})):d(e)?((0,n.wg)(),(0,n.j4)(we.t,{key:2,color:"warning",icon:"mdi-alert"})):r(e)?((0,n.wg)(),(0,n.j4)(we.t,{key:3,color:"warning",icon:"mdi-clock-alert-outline"})):((0,n.wg)(),(0,n.j4)(we.t,{key:4,icon:"mdi-check",color:"primary"})):((0,n.wg)(),(0,n.j4)(we.t,{key:0,icon:"mdi-help-circle"}))])),default:(0,n.w5)((()=>[(0,n.Wm)(ke.V,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(e.format.name),1)])),_:2},1024),e.packet?((0,n.wg)(),(0,n.j4)(Ue.o,{key:0},{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)((0,v.SU)(a).showT(e.t))+" #"+(0,g.zw)(e.count)+" "+(0,g.zw)(e.source),1)])),_:2},1024)):(0,n.kq)("",!0),e.packet?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(Ue.o,{key:1},{default:(0,n.w5)((()=>[(0,n.Uk)(" N/A ")])),_:1}))])),_:2},1040)])),default:(0,n.w5)((()=>[e.packet?((0,n.wg)(),(0,n.j4)($e.Y,{key:0,density:"compact"},{default:(0,n.w5)((()=>[(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o(e.format,e.packet),((e,t)=>((0,n.wg)(),(0,n.j4)(Ye.N,{key:t,text:e.error||e.warning||""},{activator:(0,n.w5)((({props:t})=>[(0,n._)("tr",(0,g.vs)((0,n.F4)((e.error||e.warning)&&t)),[(0,n._)("td",Ke,(0,g.zw)(e.title),1),e.error?((0,n.wg)(),(0,n.iD)("td",Ge,(0,g.zw)(e.value),1)):e.warning?((0,n.wg)(),(0,n.iD)("td",Je,(0,g.zw)(e.value),1)):((0,n.wg)(),(0,n.iD)("td",Qe,(0,g.zw)(e.value),1))],16)])),_:2},1032,["text"])))),128))])])),_:2},1024)):(0,n.kq)("",!0)])),_:2},1032,["value"])))),128))])),_:2},1032,["opened","onUpdate:opened"])])),_:2},1024)])),_:2},1024)))),128))}});const et=Xe;var tt=et,at=a(4618),it=a(5866);const lt={key:0,class:"w-100"};var nt=(0,n.aZ)({__name:"ChartList",props:["range"],setup(e){const t=e;at.kL.register(at.Dx,at.f$,at.od,at.jn,at.u,at.De,at.wL),at.kL.defaults.color="#FFFFFF",at.kL.defaults.borderColor="#888888";const a=(0,n.f3)("datastore"),i=100,l=(0,n.Fl)((()=>a.value?j.map((e=>({config:e,data:{datasets:e.y.map((e=>{const l=e[0],n=e[1],s=e[2],o=e[3]??0,r=x[n]?.entries[s],u=a.value.getBy(l,n,t.range?.min,t.range.max,i),d=[],m=u.getTimes(t.range?.min,t.range.max,i),c=u.getValues(s,o);for(let t=0;t<m.length;t++)d.push({x:m[t],y:c[t]});let h=r?.name;return r?.index&&(h+=` (${r.index[o]})`),{label:h,data:d,showLine:!0,fill:!1,pointRadius:0}}))},options:{aspectRatio:1.5,animation:!1,plugins:{title:{display:!1,text:e.title}},scales:{x:{title:{display:!0,text:"t [s]"},min:t.range?.min,max:t.range?.max},y:{title:{display:!0,text:e.yLabel}}},legend:{display:e.y.length>1},parsing:!1,normalized:!0,spanGaps:!0}}))):[]));return(e,t)=>((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,v.SU)(l),((e,t)=>((0,n.wg)(),(0,n.j4)(B._,{key:t,class:"w-100"},{default:(0,n.w5)((()=>[(0,n.Wm)(Ne._,{class:"pb-0"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(e.config.title),1)])),_:2},1024),e.data?((0,n.wg)(),(0,n.iD)("div",lt,[(0,n.Wm)((0,v.SU)(it.bp),{data:e.data,options:e.options,class:"pa-3 pt-0"},null,8,["data","options"])])):(0,n.kq)("",!0)])),_:2},1024)))),128))}});const st=nt;var ot=st,rt=a(9772),ut=(0,n.aZ)({__name:"FlightMap",props:["time"],setup(e){const t=e,a=(0,n.f3)("datastore"),i=(0,v.iH)(null),l=(0,v.iH)(18),s=(0,v.iH)([35.7061,139.7071]),o=(0,n.Fl)((()=>a.value?D.flatMap((e=>{const i=a.value.getBy(e.from,e.id).at(t.time??new Date)?.packet;if(!i)return[];const l=x[e.id],n=i.get(e.lat)?.formatNumber(l.entries[e.lat]),s=i.get(e.lon)?.formatNumber(l.entries[e.lon]);return n&&s?[{latlon:[n,s],color:e.markerColor??e.color}]:[]})):[])),r=(0,n.Fl)((()=>a.value?D.map((e=>{const t=a.value.getBy(e.from,e.id),i=t.getValues(e.lat),l=t.getValues(e.lon);return{latlons:i.map(((e,t)=>[e,l[t]])),name:e.name,color:e.color}})):[]));let u=!1;return(0,n.m0)((()=>{u||r.value[0]&&r.value[0].latlons[0]&&i.value&&i.value.leafletObject&&(i.value.leafletObject.flyTo(r.value[0].latlons[0],18),u=!0)})),(e,t)=>((0,n.wg)(),(0,n.j4)(B._,{class:"w-100",style:{"padding-top":"100%",position:"relative"}},{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(rt.iA),{ref_key:"map",ref:i,zoom:l.value,"onUpdate:zoom":t[0]||(t[0]=e=>l.value=e),center:s.value,style:{position:"absolute",top:"0"}},{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(rt.Hw),{url:"https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg","layer-type":"base",name:"OpenStreetMap"}),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,v.SU)(r),((e,t)=>((0,n.wg)(),(0,n.j4)((0,v.SU)(rt.P6),{key:t,"lat-lngs":e.latlons,color:e.color},null,8,["lat-lngs","color"])))),128)),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,v.SU)(o),((e,t)=>((0,n.wg)(),(0,n.j4)((0,v.SU)(rt.A0),{key:t,"lat-lng":e.latlon,radius:15,color:e.color},null,8,["lat-lng","color"])))),128)),(0,n.Wm)((0,v.SU)(rt.O9),{position:"topright",imperial:!1,metric:!0})])),_:1},8,["zoom","center"])])),_:1}))}});const dt=ut;var mt=dt;const ct=["src"];var ht=(0,n.aZ)({__name:"VideoPlayer",props:["video","time"],setup(e){const t=e,a=(0,v.iH)(null);let i=!1;const l=()=>{if(!a.value)return;let e=(t.time.getTime()-new Date(t.video.startTime).getTime())/1e3;e<0?e=0:e>a.value.duration&&(e=a.value.duration);const l=a.value.currentTime;Math.abs(e-l)>.1&&(a.value.currentTime=e,i&&(a.value.pause(),i=!1))};(0,n.bv)((()=>{setInterval(l,500)}));let s=0;return(0,n.YP)((()=>t.time),((e,l)=>{if(!i){const n=(new Date).getTime();if(Math.abs(e.getTime()-l.getTime()-(n-s))<10){let e=(t.time.getTime()-new Date(t.video.startTime).getTime())/1e3;0<=e&&e<a.value.duration&&(a.value.play(),i=!0)}s=n}})),(t,i)=>((0,n.wg)(),(0,n.iD)("video",{ref_key:"videoElement",ref:a,src:e.video.url,class:"w-100"},null,8,ct))}});const ft=ht;var pt=ft,wt=a(1666);const gt={class:"system h-screen overflow-hidden"};var vt=(0,n.aZ)({__name:"FlightView",setup(e){const t=(0,v.XI)(void 0),a=(0,n.Fl)((()=>t.value?.flight)),i=(0,n.Fl)((()=>a.value?.system));(0,n.JJ)("datastore",t);const l=(0,v.iH)(new Date),s=(0,v.iH)({});let o;const r=(0,w.yj)(),u=(0,w.tv)();(0,n.FN)();(0,n.bv)((async()=>{try{const e=await q.getFlight(r.query.id);t.value=new xe(e),t.value.currentTime=e.startTime,o=await q.connect(e.id,"web",e.startTime,void 0,d),console.log("flight",e,o)}catch{console.log("unknown flight",(0,n.f3)("systemId"),r.query.id),u.push("/systems")}})),(0,w.iS)(((e,t)=>{o?.close()}));const d=e=>{console.log("received",e.length),t.value.addPackets(e),(0,v.oR)(t)},m=async e=>{t.value.flight=e,(0,v.oR)(t)},c=e=>{a.value.system=e},h=e=>{l.value=e},f=e=>{s.value=e};return(e,t)=>((0,n.wg)(),(0,n.iD)("div",gt,[(0,n.Wm)(R.L,{color:"primary",height:"40"},{default:(0,n.w5)((()=>[(0,n.Wm)(N.T,{icon:"mdi-arrow-left",to:"/"}),(0,n.Wm)(ae.C),(0,n.Wm)((0,v.SU)(ze),{flight:(0,v.SU)(a),onUpdate:m},null,8,["flight"]),(0,n.Wm)(ae.C),(0,n.Wm)((0,v.SU)(he),{system:(0,v.SU)(i),onLogin:c},null,8,["system"])])),_:1}),(0,v.SU)(a)?((0,n.wg)(),(0,n.j4)(le.O,{key:0,class:"h-100 overflow-hidden"},{default:(0,n.w5)((()=>[(0,n.Wm)(X.K,{class:"ma-0 w-screen h-100"},{default:(0,n.w5)((()=>[(0,n.Wm)(ee.o,{class:"h-100"},{default:(0,n.w5)((()=>[(0,n.Wm)(X.K,{id:"graphics-panel",class:"ma-0 pa-0 h-100"},{default:(0,n.w5)((()=>[(0,n.Wm)(ee.o,{class:"h-100 ma-0"},{default:(0,n.w5)((()=>[(0,n.Wm)(te.D,{class:"pa-3 pr-1"},{default:(0,n.w5)((()=>[(0,n.Wm)(ee.o,{class:"w-100 pb-4 ma-0"},{default:(0,n.w5)((()=>[(0,v.SU)(a).data?.videos?.at(0)?((0,n.wg)(),(0,n.j4)((0,v.SU)(pt),{key:0,video:(0,v.SU)(a).data.videos[0],time:l.value},null,8,["video","time"])):(0,n.kq)("",!0)])),_:1}),(0,n.Wm)(ee.o,{class:"w-100 pb-4 ma-0"},{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(mt),{time:l.value},null,8,["time"])])),_:1})])),_:1}),(0,n.Wm)(te.D,{class:"h-100 pa-3 pr-1",style:{display:"flex","flex-direction":"column"}},{default:(0,n.w5)((()=>[(0,n.Wm)(ee.o,{class:"w-100 pb-4 ma-0",style:{"flex-grow":"0"}},{default:(0,n.w5)((()=>[(0,v.SU)(a).data?.videos?.at(1)?((0,n.wg)(),(0,n.j4)((0,v.SU)(pt),{key:0,video:(0,v.SU)(a).data.videos[1],time:l.value},null,8,["video","time"])):(0,n.kq)("",!0)])),_:1}),(0,n.Wm)(ee.o,{class:"overflow-y-auto w-100 ma-0",style:{"flex-grow":"1","padding-bottom":"50px"}},{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(ot),{range:s.value},null,8,["range"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,n.Wm)(te.D,{id:"packets-panel",class:"overflow-y-auto h-100 pb-16"},{default:(0,n.w5)((()=>[(0,n.Wm)(B._,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(tt),{time:l.value},null,8,["time"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):(0,n.kq)("",!0),(0,n.Wm)(wt.c,{fixed:"",elevation:"20"},{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(Ee),{onChangeChartRange:f,onChangeTime:h})])),_:1})]))}});const yt=vt;var kt=yt;const Ut=[{path:"/",name:"system",component:Se},{path:"/systems",name:"systemlist",component:ue},{path:"/flight",name:"flight",component:kt}],Tt=(0,w.p7)({history:(0,w.PO)(""),routes:Ut});var bt=Tt;p(),console.log("mode","production",i);const _t=(0,l.ri)(m);_t.provide("systemId",T),_t.use(bt).use(f).mount("#app")}},t={};function a(i){var l=t[i];if(void 0!==l)return l.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,a),n.exports}a.m=e,function(){var e=[];a.O=function(t,i,l,n){if(!i){var s=1/0;for(d=0;d<e.length;d++){i=e[d][0],l=e[d][1],n=e[d][2];for(var o=!0,r=0;r<i.length;r++)(!1&n||s>=n)&&Object.keys(a.O).every((function(e){return a.O[e](i[r])}))?i.splice(r--,1):(o=!1,n<s&&(s=n));if(o){e.splice(d--,1);var u=l();void 0!==u&&(t=u)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[i,l,n]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};a.t=function(i,l){if(1&l&&(i=this(i)),8&l)return i;if("object"===typeof i&&i){if(4&l&&i.__esModule)return i;if(16&l&&"function"===typeof i.then)return i}var n=Object.create(null);a.r(n);var s={};e=e||[null,t({}),t([]),t(t)];for(var o=2&l&&i;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((function(e){s[e]=function(){return i[e]}}));return s["default"]=function(){return i},a.d(n,s),n}}(),function(){a.d=function(e,t){for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,i){return a.f[i](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/"+(461===e?"webfontloader":e)+"."+{93:"7d4448a4",153:"41807072",431:"704be2dd",461:"e506e2ed",858:"8e1c553f",891:"c2316474"}[e]+".js"}}(),function(){a.miniCssF=function(e){}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="telemeter:";a.l=function(i,l,n,s){if(e[i])e[i].push(l);else{var o,r;if(void 0!==n)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var m=u[d];if(m.getAttribute("src")==i||m.getAttribute("data-webpack")==t+n){o=m;break}}o||(r=!0,o=document.createElement("script"),o.charset="utf-8",o.timeout=120,a.nc&&o.setAttribute("nonce",a.nc),o.setAttribute("data-webpack",t+n),o.src=i),e[i]=[l];var c=function(t,a){o.onerror=o.onload=null,clearTimeout(h);var l=e[i];if(delete e[i],o.parentNode&&o.parentNode.removeChild(o),l&&l.forEach((function(e){return e(a)})),t)return t(a)},h=setTimeout(c.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=c.bind(null,o.onerror),o.onload=c.bind(null,o.onload),r&&document.head.appendChild(o)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p=""}(),function(){var e={143:0};a.f.j=function(t,i){var l=a.o(e,t)?e[t]:void 0;if(0!==l)if(l)i.push(l[2]);else{var n=new Promise((function(a,i){l=e[t]=[a,i]}));i.push(l[2]=n);var s=a.p+a.u(t),o=new Error,r=function(i){if(a.o(e,t)&&(l=e[t],0!==l&&(e[t]=void 0),l)){var n=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+n+": "+s+")",o.name="ChunkLoadError",o.type=n,o.request=s,l[1](o)}};a.l(s,r,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,i){var l,n,s=i[0],o=i[1],r=i[2],u=0;if(s.some((function(t){return 0!==e[t]}))){for(l in o)a.o(o,l)&&(a.m[l]=o[l]);if(r)var d=r(a)}for(t&&t(i);u<s.length;u++)n=s[u],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(d)},i=self["webpackChunktelemeter"]=self["webpackChunktelemeter"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=a.O(void 0,[998],(function(){return a(1833)}));i=a.O(i)})();
//# sourceMappingURL=app.a6dc8584.js.map